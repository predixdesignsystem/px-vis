<script>
(function(){
  if(typeof Px === 'undefined') {
    Px = {};
  }
  Px.vis = Px.vis || {};
  if(!Px.vis.scheduler) {

    window.dispatchEvent(new CustomEvent('px-vis-worker-init'));

    //get number of cores
    var scheduler = {},
        threadCount = Px.vis.maxWorkerCount || navigator.hardwareConcurrency || 4,
        initCounter = 0,
        processDone,
        startWork;

    if(!Px.vis.workerUrl) {
      //start of blob
      var blob =  {"script":"!function(e,t){\"object\"==typeof exports&&\"undefined\"!=typeof module?t(exports):\"function\"==typeof define&&define.amd?define([\"exports\"],t):t(e.d3={})}(this,function(e){\"use strict\";function t(e,t,n){var r=(t-e)/Math.max(0,n),a=Math.floor(Math.log(r)/Math.LN10),i=r/Math.pow(10,a);return a>=0?(i>=lt?10:i>=ht?5:i>=dt?2:1)*Math.pow(10,a):-Math.pow(10,-a)/(i>=lt?10:i>=ht?5:i>=dt?2:1)}function n(e,t,n){var r=Math.abs(t-e)/Math.max(0,n),a=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),i=r/a;return i>=lt?a*=10:i>=ht?a*=5:i>=dt&&(a*=2),t<e?-a:a}function r(){}function a(e,t){var n=new r;if(e instanceof r)e.each(function(e,t){n.set(t,e)});else if(Array.isArray(e)){var a,i=-1,f=e.length;if(null==t)for(;++i<f;)n.set(i,e[i]);else for(;++i<f;)n.set(t(a=e[i],i,e),a)}else if(e)for(var c in e)n.set(c,e[c]);return n}function i(e){function t(t){var a=t+\"\",i=n.get(a);if(!i){if(f!==vt)return f;n.set(a,i=r.push(t))}return e[(i-1)%e.length]}var n=a(),r=[],f=vt;return e=null==e?[]:yt.call(e),t.domain=function(e){if(!arguments.length)return r.slice();r=[],n=a();for(var i,f,c=-1,u=e.length;++c<u;)n.has(f=(i=e[c])+\"\")||n.set(f,r.push(i));return t},t.range=function(n){return arguments.length?(e=yt.call(n),t):e.slice()},t.unknown=function(e){return arguments.length?(f=e,t):f},t.copy=function(){return i().domain(r).range(e).unknown(f)},t}function f(){function e(){var e=a().length,r=u[1]<u[0],i=u[r-0],f=u[1-r];t=(f-i)/Math.max(1,e-s+2*l),o&&(t=Math.floor(t)),i+=(f-i-t*(e-s))*h,n=t*(1-s),o&&(i=Math.round(i),n=Math.round(n));var d=st(e).map(function(e){return i+t*e});return c(r?d.reverse():d)}var t,n,r=i().unknown(void 0),a=r.domain,c=r.range,u=[0,1],o=!1,s=0,l=0,h=.5;return delete r.unknown,r.domain=function(t){return arguments.length?(a(t),e()):a()},r.range=function(t){return arguments.length?(u=[+t[0],+t[1]],e()):u.slice()},r.rangeRound=function(t){return u=[+t[0],+t[1]],o=!0,e()},r.bandwidth=function(){return n},r.step=function(){return t},r.round=function(t){return arguments.length?(o=!!t,e()):o},r.padding=function(t){return arguments.length?(s=l=Math.max(0,Math.min(1,t)),e()):s},r.paddingInner=function(t){return arguments.length?(s=Math.max(0,Math.min(1,t)),e()):s},r.paddingOuter=function(t){return arguments.length?(l=Math.max(0,Math.min(1,t)),e()):l},r.align=function(t){return arguments.length?(h=Math.max(0,Math.min(1,t)),e()):h},r.copy=function(){return f().domain(a()).range(u).round(o).paddingInner(s).paddingOuter(l).align(h)},e()}function c(e){var t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return c(t())},e}function u(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function o(){}function s(e){var t;return e=(e+\"\").trim().toLowerCase(),(t=Tt.exec(e))?(t=parseInt(t[1],16),new g(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1)):(t=_t.exec(e))?l(parseInt(t[1],16)):(t=Nt.exec(e))?new g(t[1],t[2],t[3],1):(t=Ct.exec(e))?new g(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=Ut.exec(e))?h(t[1],t[2],t[3],t[4]):(t=Dt.exec(e))?h(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=kt.exec(e))?p(t[1],t[2]/100,t[3]/100,1):(t=At.exec(e))?p(t[1],t[2]/100,t[3]/100,t[4]):Ft.hasOwnProperty(e)?l(Ft[e]):\"transparent\"===e?new g(NaN,NaN,NaN,0):null}function l(e){return new g(e>>16&255,e>>8&255,255&e,1)}function h(e,t,n,r){return r<=0&&(e=t=n=NaN),new g(e,t,n,r)}function d(e){return e instanceof o||(e=s(e)),e?(e=e.rgb(),new g(e.r,e.g,e.b,e.opacity)):new g}function b(e,t,n,r){return 1===arguments.length?d(e):new g(e,t,n,null==r?1:r)}function g(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function p(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new v(e,t,n,r)}function y(e,t,n,r){return 1===arguments.length?function(e){if(e instanceof v)return new v(e.h,e.s,e.l,e.opacity);if(e instanceof o||(e=s(e)),!e)return new v;if(e instanceof v)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,a=Math.min(t,n,r),i=Math.max(t,n,r),f=NaN,c=i-a,u=(i+a)/2;return c?(f=t===i?(n-r)/c+6*(n<r):n===i?(r-t)/c+2:(t-n)/c+4,c/=u<.5?i+a:2-i-a,f*=60):c=u>0&&u<1?0:f,new v(f,c,u,e.opacity)}(e):new v(e,t,n,null==r?1:r)}function v(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function M(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function m(e){if(e instanceof w)return new w(e.l,e.a,e.b,e.opacity);if(e instanceof U){var t=e.h*St;return new w(e.l,Math.cos(t)*e.c,Math.sin(t)*e.c,e.opacity)}e instanceof g||(e=d(e));var n=N(e.r),r=N(e.g),a=N(e.b),i=x((.4124564*n+.3575761*r+.1804375*a)/Ht),f=x((.2126729*n+.7151522*r+.072175*a)/$t);return new w(116*f-16,500*(i-f),200*(f-x((.0193339*n+.119192*r+.9503041*a)/Lt)),e.opacity)}function w(e,t,n,r){this.l=+e,this.a=+t,this.b=+n,this.opacity=+r}function x(e){return e>qt?Math.pow(e,1/3):e/Ot+jt}function T(e){return e>It?e*e*e:Ot*(e-jt)}function _(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function N(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function C(e,t,n,r){return 1===arguments.length?function(e){if(e instanceof U)return new U(e.h,e.c,e.l,e.opacity);e instanceof w||(e=m(e));var t=Math.atan2(e.b,e.a)*Yt;return new U(t<0?t+360:t,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}(e):new U(e,t,n,null==r?1:r)}function U(e,t,n,r){this.h=+e,this.c=+t,this.l=+n,this.opacity=+r}function D(e,t,n,r){return 1===arguments.length?function(e){if(e instanceof k)return new k(e.h,e.s,e.l,e.opacity);e instanceof g||(e=d(e));var t=e.r/255,n=e.g/255,r=e.b/255,a=(Qt*r+Wt*t-Vt*n)/(Qt+Wt-Vt),i=r-a,f=(Rt*(n-a)-Pt*i)/Zt,c=Math.sqrt(f*f+i*i)/(Rt*a*(1-a)),u=c?Math.atan2(f,i)*Yt-120:NaN;return new k(u<0?u+360:u,c,a,e.opacity)}(e):new k(e,t,n,null==r?1:r)}function k(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function A(e,t){return function(n){return e+n*t}}function F(e){return 1==(e=+e)?S:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}(t,n,e):Xt(isNaN(t)?n:t)}}function S(e,t){var n=t-e;return n?A(e,n):Xt(isNaN(e)?t:e)}function Y(e){return function t(n){function r(t,r){var a=e((t=D(t)).h,(r=D(r)).h),i=S(t.s,r.s),f=S(t.l,r.l),c=S(t.opacity,r.opacity);return function(e){return t.h=a(e),t.s=i(e),t.l=f(Math.pow(e,n)),t.opacity=c(e),t+\"\"}}return n=+n,r.gamma=t,r}(1)}function H(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:an(t)}function $(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp())}function L(e,t){function n(){return a=Math.min(c.length,u.length)>2?function(e,t,n,r){var a=Math.min(e.length,t.length)-1,i=new Array(a),f=new Array(a),c=-1;for(e[a]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++c<a;)i[c]=n(e[c],e[c+1]),f[c]=r(t[c],t[c+1]);return function(t){var n=ot(e,t,1,a)-1;return f[n](i[n](t))}}:function(e,t,n,r){var a=e[0],i=e[1],f=t[0],c=t[1];return i<a?(a=n(i,a),f=r(c,f)):(a=n(a,i),f=r(f,c)),function(e){return f(a(e))}},i=f=null,r}function r(t){return(i||(i=a(c,u,s?function(e){return function(t,n){var r=e(t=+t,n=+n);return function(e){return e<=t?0:e>=n?1:r(e)}}}(e):e,o)))(+t)}var a,i,f,c=cn,u=cn,o=en,s=!1;return r.invert=function(e){return(f||(f=a(u,c,H,s?function(e){return function(t,n){var r=e(t=+t,n=+n);return function(e){return e<=0?t:e>=1?n:r(e)}}}(t):t)))(+e)},r.domain=function(e){return arguments.length?(c=pt.call(e,fn),n()):c.slice()},r.range=function(e){return arguments.length?(u=yt.call(e),n()):u.slice()},r.rangeRound=function(e){return u=yt.call(e),o=tn,n()},r.clamp=function(e){return arguments.length?(s=!!e,n()):s},r.interpolate=function(e){return arguments.length?(o=e,n()):o},n()}function j(e){return new I(e)}function I(e){if(!(t=hn.exec(e)))throw new Error(\"invalid format: \"+e);var t,n=t[1]||\" \",r=t[2]||\">\",a=t[3]||\"-\",i=t[4]||\"\",f=!!t[5],c=t[6]&&+t[6],u=!!t[7],o=t[8]&&+t[8].slice(1),s=t[9]||\"\";\"n\"===s?(u=!0,s=\"g\"):ln[s]||(s=\"\"),(f||\"0\"===n&&\"=\"===r)&&(f=!0,n=\"0\",r=\"=\"),this.fill=n,this.align=r,this.sign=a,this.symbol=i,this.zero=f,this.width=c,this.comma=u,this.precision=o,this.type=s}function O(){var e=L(H,Bt);return e.copy=function(){return $(e,O())},function(e){var n=e.domain;return e.ticks=function(e){var t=n();return bt(t[0],t[t.length-1],null==e?10:e)},e.tickFormat=function(e,t){return Mn(n(),e,t)},e.nice=function(r){null==r&&(r=10);var a,i=n(),f=0,c=i.length-1,u=i[f],o=i[c];return o<u&&(a=u,u=o,o=a,a=f,f=c,c=a),(a=t(u,o,r))>0?a=t(u=Math.floor(u/a)*a,o=Math.ceil(o/a)*a,r):a<0&&(a=t(u=Math.ceil(u*a)/a,o=Math.floor(o*a)/a,r)),a>0?(i[f]=Math.floor(u/a)*a,i[c]=Math.ceil(o/a)*a,n(i)):a<0&&(i[f]=Math.ceil(u*a)/a,i[c]=Math.floor(o*a)/a,n(i)),e},e}(e)}function q(e,t,n,r){function a(t){return e(t=new Date(+t)),t}return a.floor=a,a.ceil=function(n){return e(n=new Date(n-1)),t(n,1),e(n),n},a.round=function(e){var t=a(e),n=a.ceil(e);return e-t<n-e?t:n},a.offset=function(e,n){return t(e=new Date(+e),null==n?1:Math.floor(n)),e},a.range=function(n,r,i){var f=[];if(n=a.ceil(n),i=null==i?1:Math.floor(i),!(n<r&&i>0))return f;do{f.push(new Date(+n))}while(t(n,i),e(n),n<r);return f},a.filter=function(n){return q(function(t){if(t>=t)for(;e(t),!n(t);)t.setTime(t-1)},function(e,r){if(e>=e)if(r<0)for(;++r<=0;)for(;t(e,-1),!n(e););else for(;--r>=0;)for(;t(e,1),!n(e););})},n&&(a.count=function(t,r){return wn.setTime(+t),xn.setTime(+r),e(wn),e(xn),Math.floor(n(wn,xn))},a.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?a.filter(r?function(t){return r(t)%e==0}:function(t){return a.count(0,t)%e==0}):a:null}),a}function E(e){return q(function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},function(e,t){e.setDate(e.getDate()+7*t)},function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*_n)/Nn})}function z(e){return q(function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},function(e,t){e.setUTCDate(e.getUTCDate()+7*t)},function(e,t){return(t-e)/Nn})}function P(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function Z(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function R(e){return{y:e,m:0,d:1,H:0,M:0,S:0,L:0}}function W(e,t,n){var r=e<0?\"-\":\"\",a=(r?-e:e)+\"\",i=a.length;return r+(i<n?new Array(n-i+1).join(t)+a:a)}function V(e){return e.replace(Bn,\"\\\\$&\")}function Q(e){return new RegExp(\"^(?:\"+e.map(V).join(\"|\")+\")\",\"i\")}function X(e){for(var t={},n=-1,r=e.length;++n<r;)t[e[n].toLowerCase()]=n;return t}function J(e,t,n){var r=Xn.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function B(e,t,n){var r=Xn.exec(t.slice(n,n+1));return r?(e.u=+r[0],n+r[0].length):-1}function G(e,t,n){var r=Xn.exec(t.slice(n,n+2));return r?(e.U=+r[0],n+r[0].length):-1}function K(e,t,n){var r=Xn.exec(t.slice(n,n+2));return r?(e.V=+r[0],n+r[0].length):-1}function ee(e,t,n){var r=Xn.exec(t.slice(n,n+2));return r?(e.W=+r[0],n+r[0].length):-1}function te(e,t,n){var r=Xn.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function ne(e,t,n){var r=Xn.exec(t.slice(n,n+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function re(e,t,n){var r=/^(Z)|([+-]\\d\\d)(?::?(\\d\\d))?/.exec(t.slice(n,n+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||\"00\")),n+r[0].length):-1}function ae(e,t,n){var r=Xn.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function ie(e,t,n){var r=Xn.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function fe(e,t,n){var r=Xn.exec(t.slice(n,n+3));return r?(e.m=0,e.d=+r[0],n+r[0].length):-1}function ce(e,t,n){var r=Xn.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function ue(e,t,n){var r=Xn.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function oe(e,t,n){var r=Xn.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function se(e,t,n){var r=Xn.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function le(e,t,n){var r=Xn.exec(t.slice(n,n+6));return r?(e.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function he(e,t,n){var r=Jn.exec(t.slice(n,n+1));return r?n+r[0].length:-1}function de(e,t,n){var r=Xn.exec(t.slice(n));return r?(e.Q=+r[0],n+r[0].length):-1}function be(e,t,n){var r=Xn.exec(t.slice(n));return r?(e.Q=1e3*+r[0],n+r[0].length):-1}function ge(e,t){return W(e.getDate(),t,2)}function pe(e,t){return W(e.getHours(),t,2)}function ye(e,t){return W(e.getHours()%12||12,t,2)}function ve(e,t){return W(1+kn.count(Hn(e),e),t,3)}function Me(e,t){return W(e.getMilliseconds(),t,3)}function me(e,t){return Me(e,t)+\"000\"}function we(e,t){return W(e.getMonth()+1,t,2)}function xe(e,t){return W(e.getMinutes(),t,2)}function Te(e,t){return W(e.getSeconds(),t,2)}function _e(e){var t=e.getDay();return 0===t?7:t}function Ne(e,t){return W(An.count(Hn(e),e),t,2)}function Ce(e,t){var n=e.getDay();return e=n>=4||0===n?Sn(e):Sn.ceil(e),W(Sn.count(Hn(e),e)+(4===Hn(e).getDay()),t,2)}function Ue(e){return e.getDay()}function De(e,t){return W(Fn.count(Hn(e),e),t,2)}function ke(e,t){return W(e.getFullYear()%100,t,2)}function Ae(e,t){return W(e.getFullYear()%1e4,t,4)}function Fe(e){var t=e.getTimezoneOffset();return(t>0?\"-\":(t*=-1,\"+\"))+W(t/60|0,\"0\",2)+W(t%60,\"0\",2)}function Se(e,t){return W(e.getUTCDate(),t,2)}function Ye(e,t){return W(e.getUTCHours(),t,2)}function He(e,t){return W(e.getUTCHours()%12||12,t,2)}function $e(e,t){return W(1+jn.count(zn(e),e),t,3)}function Le(e,t){return W(e.getUTCMilliseconds(),t,3)}function je(e,t){return Le(e,t)+\"000\"}function Ie(e,t){return W(e.getUTCMonth()+1,t,2)}function Oe(e,t){return W(e.getUTCMinutes(),t,2)}function qe(e,t){return W(e.getUTCSeconds(),t,2)}function Ee(e){var t=e.getUTCDay();return 0===t?7:t}function ze(e,t){return W(In.count(zn(e),e),t,2)}function Pe(e,t){var n=e.getUTCDay();return e=n>=4||0===n?qn(e):qn.ceil(e),W(qn.count(zn(e),e)+(4===zn(e).getUTCDay()),t,2)}function Ze(e){return e.getUTCDay()}function Re(e,t){return W(On.count(zn(e),e),t,2)}function We(e,t){return W(e.getUTCFullYear()%100,t,2)}function Ve(e,t){return W(e.getUTCFullYear()%1e4,t,4)}function Qe(){return\"+0000\"}function Xe(){return\"%\"}function Je(e){return+e}function Be(e){return Math.floor(+e/1e3)}function Ge(e){return Pn=function(e){function t(e,t){return function(n){var r,a,i,f=[],c=-1,u=0,o=e.length;for(n instanceof Date||(n=new Date(+n));++c<o;)37===e.charCodeAt(c)&&(f.push(e.slice(u,c)),null!=(a=Qn[r=e.charAt(++c)])?r=e.charAt(++c):a=\"e\"===r?\" \":\"0\",(i=t[r])&&(r=i(n,a)),f.push(r),u=c+1);return f.push(e.slice(u,c)),f.join(\"\")}}function n(e,t){return function(n){var a,i,f=R(1900);if(r(f,e,n+=\"\",0)!=n.length)return null;if(\"Q\"in f)return new Date(f.Q);if(\"p\"in f&&(f.H=f.H%12+12*f.p),\"V\"in f){if(f.V<1||f.V>53)return null;\"w\"in f||(f.w=1),\"Z\"in f?(a=(i=(a=Z(R(f.y))).getUTCDay())>4||0===i?On.ceil(a):On(a),a=jn.offset(a,7*(f.V-1)),f.y=a.getUTCFullYear(),f.m=a.getUTCMonth(),f.d=a.getUTCDate()+(f.w+6)%7):(a=(i=(a=t(R(f.y))).getDay())>4||0===i?Fn.ceil(a):Fn(a),a=kn.offset(a,7*(f.V-1)),f.y=a.getFullYear(),f.m=a.getMonth(),f.d=a.getDate()+(f.w+6)%7)}else(\"W\"in f||\"U\"in f)&&(\"w\"in f||(f.w=\"u\"in f?f.u%7:\"W\"in f?1:0),i=\"Z\"in f?Z(R(f.y)).getUTCDay():t(R(f.y)).getDay(),f.m=0,f.d=\"W\"in f?(f.w+6)%7+7*f.W-(i+5)%7:f.w+7*f.U-(i+6)%7);return\"Z\"in f?(f.H+=f.Z/100|0,f.M+=f.Z%100,Z(f)):t(f)}}function r(e,t,n,r){for(var a,i,f=0,c=t.length,u=n.length;f<c;){if(r>=u)return-1;if(37===(a=t.charCodeAt(f++))){if(a=t.charAt(f++),!(i=_[a in Qn?t.charAt(f++):a])||(r=i(e,n,r))<0)return-1}else if(a!=n.charCodeAt(r++))return-1}return r}var a=e.dateTime,i=e.date,f=e.time,c=e.periods,u=e.days,o=e.shortDays,s=e.months,l=e.shortMonths,h=Q(c),d=X(c),b=Q(u),g=X(u),p=Q(o),y=X(o),v=Q(s),M=X(s),m=Q(l),w=X(l),x={a:function(e){return o[e.getDay()]},A:function(e){return u[e.getDay()]},b:function(e){return l[e.getMonth()]},B:function(e){return s[e.getMonth()]},c:null,d:ge,e:ge,f:me,H:pe,I:ye,j:ve,L:Me,m:we,M:xe,p:function(e){return c[+(e.getHours()>=12)]},Q:Je,s:Be,S:Te,u:_e,U:Ne,V:Ce,w:Ue,W:De,x:null,X:null,y:ke,Y:Ae,Z:Fe,\"%\":Xe},T={a:function(e){return o[e.getUTCDay()]},A:function(e){return u[e.getUTCDay()]},b:function(e){return l[e.getUTCMonth()]},B:function(e){return s[e.getUTCMonth()]},c:null,d:Se,e:Se,f:je,H:Ye,I:He,j:$e,L:Le,m:Ie,M:Oe,p:function(e){return c[+(e.getUTCHours()>=12)]},Q:Je,s:Be,S:qe,u:Ee,U:ze,V:Pe,w:Ze,W:Re,x:null,X:null,y:We,Y:Ve,Z:Qe,\"%\":Xe},_={a:function(e,t,n){var r=p.exec(t.slice(n));return r?(e.w=y[r[0].toLowerCase()],n+r[0].length):-1},A:function(e,t,n){var r=b.exec(t.slice(n));return r?(e.w=g[r[0].toLowerCase()],n+r[0].length):-1},b:function(e,t,n){var r=m.exec(t.slice(n));return r?(e.m=w[r[0].toLowerCase()],n+r[0].length):-1},B:function(e,t,n){var r=v.exec(t.slice(n));return r?(e.m=M[r[0].toLowerCase()],n+r[0].length):-1},c:function(e,t,n){return r(e,a,t,n)},d:ie,e:ie,f:le,H:ce,I:ce,j:fe,L:se,m:ae,M:ue,p:function(e,t,n){var r=h.exec(t.slice(n));return r?(e.p=d[r[0].toLowerCase()],n+r[0].length):-1},Q:de,s:be,S:oe,u:B,U:G,V:K,w:J,W:ee,x:function(e,t,n){return r(e,i,t,n)},X:function(e,t,n){return r(e,f,t,n)},y:ne,Y:te,Z:re,\"%\":he};return x.x=t(i,x),x.X=t(f,x),x.c=t(a,x),T.x=t(i,T),T.X=t(f,T),T.c=t(a,T),{format:function(e){var n=t(e+=\"\",x);return n.toString=function(){return e},n},parse:function(e){var t=n(e+=\"\",P);return t.toString=function(){return e},t},utcFormat:function(e){var n=t(e+=\"\",T);return n.toString=function(){return e},n},utcParse:function(e){var t=n(e,Z);return t.toString=function(){return e},t}}}(e),Zn=Pn.format,Rn=Pn.parse,Wn=Pn.utcFormat,Vn=Pn.utcParse,Pn}function Ke(e){return new Date(e)}function et(e){return e instanceof Date?+e:+new Date(+e)}function tt(e,t,r,a,i,f,c,u,o){function s(t,r,a,i){if(null==t&&(t=10),\"number\"==typeof t){var f=Math.abs(a-r)/t,c=ut(function(e){return e[2]}).right(x,f);c===x.length?(i=n(r/ar,a/ar,t),t=e):c?(i=(c=x[f/x[c-1][2]<x[c][2]/f?c-1:c])[1],t=c[0]):(i=n(r,a,t),t=u)}return null==i?t:t.every(i)}var l=L(H,Bt),h=l.invert,d=l.domain,b=o(\".%L\"),g=o(\":%S\"),p=o(\"%I:%M\"),y=o(\"%I %p\"),v=o(\"%a %d\"),M=o(\"%b %d\"),m=o(\"%B\"),w=o(\"%Y\"),x=[[c,1,Gn],[c,5,5*Gn],[c,15,15*Gn],[c,30,30*Gn],[f,1,Kn],[f,5,5*Kn],[f,15,15*Kn],[f,30,30*Kn],[i,1,er],[i,3,3*er],[i,6,6*er],[i,12,12*er],[a,1,tr],[a,2,2*tr],[r,1,nr],[t,1,rr],[t,3,3*rr],[e,1,ar]];return l.invert=function(e){return new Date(h(e))},l.domain=function(e){return arguments.length?d(pt.call(e,et)):d().map(Ke)},l.ticks=function(e,t){var n,r=d(),a=r[0],i=r[r.length-1],f=i<a;return f&&(n=a,a=i,i=n),n=s(e,a,i,t),n=n?n.range(a,i+1):[],f?n.reverse():n},l.tickFormat=function(n,u){return null==u?function(n){return(c(n)<n?b:f(n)<n?g:i(n)<n?p:a(n)<n?y:t(n)<n?r(n)<n?v:M:e(n)<n?m:w)(n)}:o(u)},l.nice=function(e,t){var n=d();return(e=s(e,n[0],n[n.length-1],t))?d(mn(n,e)):l},l.copy=function(){return $(l,tt(e,t,r,a,i,f,c,u,o))},l}function nt(e){var t=e.length;return function(n){return e[Math.max(0,Math.min(t-1,Math.floor(n*t)))]}}function rt(e,t,n,r){if(isNaN(t)||isNaN(n))return e;var a,i,f,c,u,o,s,l,h,d=e._root,b={data:r},g=e._x0,p=e._y0,y=e._x1,v=e._y1;if(!d)return e._root=b,e;for(;d.length;)if((o=t>=(i=(g+y)/2))?g=i:y=i,(s=n>=(f=(p+v)/2))?p=f:v=f,a=d,!(d=d[l=s<<1|o]))return a[l]=b,e;if(c=+e._x.call(null,d.data),u=+e._y.call(null,d.data),t===c&&n===u)return b.next=d,a?a[l]=b:e._root=b,e;do{a=a?a[l]=new Array(4):e._root=new Array(4),(o=t>=(i=(g+y)/2))?g=i:y=i,(s=n>=(f=(p+v)/2))?p=f:v=f}while((l=s<<1|o)==(h=(u>=f)<<1|c>=i));return a[h]=d,a[l]=b,e}function at(e,t,n){var r=new it(null==t?function(e){return e[0]}:t,null==n?function(e){return e[1]}:n,NaN,NaN,NaN,NaN);return null==e?r:r.addAll(e)}function it(e,t,n,r,a,i){this._x=e,this._y=t,this._x0=n,this._y0=r,this._x1=a,this._y1=i,this._root=void 0}function ft(e){for(var t={data:e.data},n=t;e=e.next;)n=n.next={data:e.data};return t}var ct=function(e,t){return e<t?-1:e>t?1:e>=t?0:NaN},ut=function(e){return 1===e.length&&(e=function(e){return function(t,n){return ct(e(t),n)}}(e)),{left:function(t,n,r,a){for(null==r&&(r=0),null==a&&(a=t.length);r<a;){var i=r+a>>>1;e(t[i],n)<0?r=i+1:a=i}return r},right:function(t,n,r,a){for(null==r&&(r=0),null==a&&(a=t.length);r<a;){var i=r+a>>>1;e(t[i],n)>0?a=i:r=i+1}return r}}},ot=ut(ct).right,st=function(e,t,n){e=+e,t=+t,n=(a=arguments.length)<2?(t=e,e=0,1):a<3?1:+n;for(var r=-1,a=0|Math.max(0,Math.ceil((t-e)/n)),i=new Array(a);++r<a;)i[r]=e+r*n;return i},lt=Math.sqrt(50),ht=Math.sqrt(10),dt=Math.sqrt(2),bt=function(e,n,r){var a,i,f,c,u=-1;if(n=+n,e=+e,r=+r,e===n&&r>0)return[e];if((a=n<e)&&(i=e,e=n,n=i),0===(c=t(e,n,r))||!isFinite(c))return[];if(c>0)for(e=Math.ceil(e/c),n=Math.floor(n/c),f=new Array(i=Math.ceil(n-e+1));++u<i;)f[u]=(e+u)*c;else for(e=Math.floor(e*c),n=Math.ceil(n*c),f=new Array(i=Math.ceil(e-n+1));++u<i;)f[u]=(e-u)/c;return a&&f.reverse(),f};r.prototype=a.prototype={constructor:r,has:function(e){return\"$\"+e in this},get:function(e){return this[\"$\"+e]},set:function(e,t){return this[\"$\"+e]=t,this},remove:function(e){var t=\"$\"+e;return t in this&&delete this[t]},clear:function(){for(var e in this)\"$\"===e[0]&&delete this[e]},keys:function(){var e=[];for(var t in this)\"$\"===t[0]&&e.push(t.slice(1));return e},values:function(){var e=[];for(var t in this)\"$\"===t[0]&&e.push(this[t]);return e},entries:function(){var e=[];for(var t in this)\"$\"===t[0]&&e.push({key:t.slice(1),value:this[t]});return e},size:function(){var e=0;for(var t in this)\"$\"===t[0]&&++e;return e},empty:function(){for(var e in this)if(\"$\"===e[0])return!1;return!0},each:function(e){for(var t in this)\"$\"===t[0]&&e(this[t],t.slice(1),this)}};var gt=Array.prototype,pt=gt.map,yt=gt.slice,vt={name:\"implicit\"},Mt=function(e,t,n){e.prototype=t.prototype=n,n.constructor=e},mt=\"\\\\s*([+-]?\\\\d+)\\\\s*\",wt=\"\\\\s*([+-]?\\\\d*\\\\.?\\\\d+(?:[eE][+-]?\\\\d+)?)\\\\s*\",xt=\"\\\\s*([+-]?\\\\d*\\\\.?\\\\d+(?:[eE][+-]?\\\\d+)?)%\\\\s*\",Tt=/^#([0-9a-f]{3})$/,_t=/^#([0-9a-f]{6})$/,Nt=new RegExp(\"^rgb\\\\(\"+[mt,mt,mt]+\"\\\\)$\"),Ct=new RegExp(\"^rgb\\\\(\"+[xt,xt,xt]+\"\\\\)$\"),Ut=new RegExp(\"^rgba\\\\(\"+[mt,mt,mt,wt]+\"\\\\)$\"),Dt=new RegExp(\"^rgba\\\\(\"+[xt,xt,xt,wt]+\"\\\\)$\"),kt=new RegExp(\"^hsl\\\\(\"+[wt,xt,xt]+\"\\\\)$\"),At=new RegExp(\"^hsla\\\\(\"+[wt,xt,xt,wt]+\"\\\\)$\"),Ft={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Mt(o,s,{displayable:function(){return this.rgb().displayable()},toString:function(){return this.rgb()+\"\"}}),Mt(g,b,u(o,{brighter:function(e){return e=null==e?1/.7:Math.pow(1/.7,e),new g(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=null==e?.7:Math.pow(.7,e),new g(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return 0<=this.r&&this.r<=255&&0<=this.g&&this.g<=255&&0<=this.b&&this.b<=255&&0<=this.opacity&&this.opacity<=1},toString:function(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?\"rgb(\":\"rgba(\")+Math.max(0,Math.min(255,Math.round(this.r)||0))+\", \"+Math.max(0,Math.min(255,Math.round(this.g)||0))+\", \"+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===e?\")\":\", \"+e+\")\")}})),Mt(v,y,u(o,{brighter:function(e){return e=null==e?1/.7:Math.pow(1/.7,e),new v(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?.7:Math.pow(.7,e),new v(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,a=2*n-r;return new g(M(e>=240?e-240:e+120,a,r),M(e,a,r),M(e<120?e+240:e-120,a,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1}}));var St=Math.PI/180,Yt=180/Math.PI,Ht=.95047,$t=1,Lt=1.08883,jt=4/29,It=6/29,Ot=3*It*It,qt=It*It*It;Mt(w,function(e,t,n,r){return 1===arguments.length?m(e):new w(e,t,n,null==r?1:r)},u(o,{brighter:function(e){return new w(this.l+18*(null==e?1:e),this.a,this.b,this.opacity)},darker:function(e){return new w(this.l-18*(null==e?1:e),this.a,this.b,this.opacity)},rgb:function(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,n=isNaN(this.b)?e:e-this.b/200;return e=$t*T(e),t=Ht*T(t),n=Lt*T(n),new g(_(3.2404542*t-1.5371385*e-.4985314*n),_(-.969266*t+1.8760108*e+.041556*n),_(.0556434*t-.2040259*e+1.0572252*n),this.opacity)}})),Mt(U,C,u(o,{brighter:function(e){return new U(this.h,this.c,this.l+18*(null==e?1:e),this.opacity)},darker:function(e){return new U(this.h,this.c,this.l-18*(null==e?1:e),this.opacity)},rgb:function(){return m(this).rgb()}}));var Et=-.14861,zt=1.78277,Pt=-.29227,Zt=-.90649,Rt=1.97294,Wt=Rt*Zt,Vt=Rt*zt,Qt=zt*Pt-Zt*Et;Mt(k,D,u(o,{brighter:function(e){return e=null==e?1/.7:Math.pow(1/.7,e),new k(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?.7:Math.pow(.7,e),new k(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=isNaN(this.h)?0:(this.h+120)*St,t=+this.l,n=isNaN(this.s)?0:this.s*t*(1-t),r=Math.cos(e),a=Math.sin(e);return new g(255*(t+n*(Et*r+zt*a)),255*(t+n*(Pt*r+Zt*a)),255*(t+n*(Rt*r)),this.opacity)}}));var Xt=function(e){return function(){return e}},Jt=function e(t){function n(e,t){var n=r((e=b(e)).r,(t=b(t)).r),a=r(e.g,t.g),i=r(e.b,t.b),f=S(e.opacity,t.opacity);return function(t){return e.r=n(t),e.g=a(t),e.b=i(t),e.opacity=f(t),e+\"\"}}var r=F(t);return n.gamma=e,n}(1),Bt=function(e,t){return e=+e,t-=e,function(n){return e+t*n}},Gt=/[-+]?(?:\\d+\\.?\\d*|\\.?\\d+)(?:[eE][-+]?\\d+)?/g,Kt=new RegExp(Gt.source,\"g\"),en=function(e,t){var n,r=typeof t;return null==t||\"boolean\"===r?Xt(t):(\"number\"===r?Bt:\"string\"===r?(n=s(t))?(t=n,Jt):function(e,t){var n,r,a,i=Gt.lastIndex=Kt.lastIndex=0,f=-1,c=[],u=[];for(e+=\"\",t+=\"\";(n=Gt.exec(e))&&(r=Kt.exec(t));)(a=r.index)>i&&(a=t.slice(i,a),c[f]?c[f]+=a:c[++f]=a),(n=n[0])===(r=r[0])?c[f]?c[f]+=r:c[++f]=r:(c[++f]=null,u.push({i:f,x:Bt(n,r)})),i=Kt.lastIndex;return i<t.length&&(a=t.slice(i),c[f]?c[f]+=a:c[++f]=a),c.length<2?u[0]?function(e){return function(t){return e(t)+\"\"}}(u[0].x):function(e){return function(){return e}}(t):(t=u.length,function(e){for(var n,r=0;r<t;++r)c[(n=u[r]).i]=n.x(e);return c.join(\"\")})}:t instanceof s?Jt:t instanceof Date?function(e,t){var n=new Date;return e=+e,t-=e,function(r){return n.setTime(e+t*r),n}}:Array.isArray(t)?function(e,t){var n,r=t?t.length:0,a=e?Math.min(r,e.length):0,i=new Array(r),f=new Array(r);for(n=0;n<a;++n)i[n]=en(e[n],t[n]);for(;n<r;++n)f[n]=t[n];return function(e){for(n=0;n<a;++n)f[n]=i[n](e);return f}}:\"function\"!=typeof t.valueOf&&\"function\"!=typeof t.toString||isNaN(t)?function(e,t){var n,r={},a={};null!==e&&\"object\"==typeof e||(e={}),null!==t&&\"object\"==typeof t||(t={});for(n in t)n in e?r[n]=en(e[n],t[n]):a[n]=t[n];return function(e){for(n in r)a[n]=r[n](e);return a}}:Bt)(e,t)},tn=function(e,t){return e=+e,t-=e,function(n){return Math.round(e+t*n)}};Math.PI,Math.SQRT2;Y(function(e,t){var n=t-e;return n?A(e,n>180||n<-180?n-360*Math.round(n/360):n):Xt(isNaN(e)?t:e)});var nn,rn=Y(S),an=function(e){return function(){return e}},fn=function(e){return+e},cn=[0,1],un=function(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf(\"e\"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]},on=function(e){return(e=un(Math.abs(e)))?e[1]:NaN},sn=function(e,t){var n=un(e,t);if(!n)return e+\"\";var r=n[0],a=n[1];return a<0?\"0.\"+new Array(-a).join(\"0\")+r:r.length>a+1?r.slice(0,a+1)+\".\"+r.slice(a+1):r+new Array(a-r.length+2).join(\"0\")},ln={\"\":function(e,t){e:for(var n,r=(e=e.toPrecision(t)).length,a=1,i=-1;a<r;++a)switch(e[a]){case\".\":i=n=a;break;case\"0\":0===i&&(i=a),n=a;break;case\"e\":break e;default:i>0&&(i=0)}return i>0?e.slice(0,i)+e.slice(n+1):e},\"%\":function(e,t){return(100*e).toFixed(t)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+\"\"},d:function(e){return Math.round(e).toString(10)},e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},g:function(e,t){return e.toPrecision(t)},o:function(e){return Math.round(e).toString(8)},p:function(e,t){return sn(100*e,t)},r:sn,s:function(e,t){var n=un(e,t);if(!n)return e+\"\";var r=n[0],a=n[1],i=a-(nn=3*Math.max(-8,Math.min(8,Math.floor(a/3))))+1,f=r.length;return i===f?r:i>f?r+new Array(i-f+1).join(\"0\"):i>0?r.slice(0,i)+\".\"+r.slice(i):\"0.\"+new Array(1-i).join(\"0\")+un(e,Math.max(0,t+i-1))[0]},X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}},hn=/^(?:(.)?([<>=^]))?([+\\-\\( ])?([$#])?(0)?(\\d+)?(,)?(\\.\\d+)?([a-z%])?$/i;j.prototype=I.prototype,I.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?\"0\":\"\")+(null==this.width?\"\":Math.max(1,0|this.width))+(this.comma?\",\":\"\")+(null==this.precision?\"\":\".\"+Math.max(0,0|this.precision))+this.type};var dn,bn,gn,pn=function(e){return e},yn=[\"y\",\"z\",\"a\",\"f\",\"p\",\"n\",\"Âµ\",\"m\",\"\",\"k\",\"M\",\"G\",\"T\",\"P\",\"E\",\"Z\",\"Y\"],vn=function(e){function t(e){function t(e){var t,r,f,s=p,m=y;if(\"c\"===g)m=v(e)+m,e=\"\";else{var w=(e=+e)<0;if(e=v(Math.abs(e),b),w&&0==+e&&(w=!1),s=(w?\"(\"===o?o:\"-\":\"-\"===o||\"(\"===o?\"\":o)+s,m=m+(\"s\"===g?yn[8+nn/3]:\"\")+(w&&\"(\"===o?\")\":\"\"),M)for(t=-1,r=e.length;++t<r;)if(48>(f=e.charCodeAt(t))||f>57){m=(46===f?a+e.slice(t+1):e.slice(t))+m,e=e.slice(0,t);break}}d&&!l&&(e=n(e,1/0));var x=s.length+e.length+m.length,T=x<h?new Array(h-x+1).join(c):\"\";switch(d&&l&&(e=n(T+e,T.length?h-m.length:1/0),T=\"\"),u){case\"<\":e=s+e+m+T;break;case\"=\":e=s+T+e+m;break;case\"^\":e=T.slice(0,x=T.length>>1)+s+e+m+T.slice(x);break;default:e=T+s+e+m}return i(e)}var c=(e=j(e)).fill,u=e.align,o=e.sign,s=e.symbol,l=e.zero,h=e.width,d=e.comma,b=e.precision,g=e.type,p=\"$\"===s?r[0]:\"#\"===s&&/[boxX]/.test(g)?\"0\"+g.toLowerCase():\"\",y=\"$\"===s?r[1]:/[%p]/.test(g)?f:\"\",v=ln[g],M=!g||/[defgprs%]/.test(g);return b=null==b?g?6:12:/[gprs]/.test(g)?Math.max(1,Math.min(21,b)):Math.max(0,Math.min(20,b)),t.toString=function(){return e+\"\"},t}var n=e.grouping&&e.thousands?function(e,t){return function(n,r){for(var a=n.length,i=[],f=0,c=e[0],u=0;a>0&&c>0&&(u+c+1>r&&(c=Math.max(1,r-u)),i.push(n.substring(a-=c,a+c)),!((u+=c+1)>r));)c=e[f=(f+1)%e.length];return i.reverse().join(t)}}(e.grouping,e.thousands):pn,r=e.currency,a=e.decimal,i=e.numerals?function(e){return function(t){return t.replace(/[0-9]/g,function(t){return e[+t]})}}(e.numerals):pn,f=e.percent||\"%\";return{format:t,formatPrefix:function(e,n){var r=t((e=j(e),e.type=\"f\",e)),a=3*Math.max(-8,Math.min(8,Math.floor(on(n)/3))),i=Math.pow(10,-a),f=yn[8+a/3];return function(e){return r(i*e)+f}}}};!function(e){dn=vn(e),bn=dn.format,gn=dn.formatPrefix}({decimal:\".\",thousands:\",\",grouping:[3],currency:[\"$\",\"\"]});var Mn=function(e,t,r){var a,i=e[0],f=e[e.length-1],c=n(i,f,null==t?10:t);switch((r=j(null==r?\",f\":r)).type){case\"s\":var u=Math.max(Math.abs(i),Math.abs(f));return null!=r.precision||isNaN(a=function(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(on(t)/3)))-on(Math.abs(e)))}(c,u))||(r.precision=a),gn(r,u);case\"\":case\"e\":case\"g\":case\"p\":case\"r\":null!=r.precision||isNaN(a=function(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,on(t)-on(e))+1}(c,Math.max(Math.abs(i),Math.abs(f))))||(r.precision=a-(\"e\"===r.type));break;case\"f\":case\"%\":null!=r.precision||isNaN(a=function(e){return Math.max(0,-on(Math.abs(e)))}(c))||(r.precision=a-2*(\"%\"===r.type))}return bn(r)},mn=function(e,t){var n,r=0,a=(e=e.slice()).length-1,i=e[r],f=e[a];return f<i&&(n=r,r=a,a=n,n=i,i=f,f=n),e[r]=t.floor(i),e[a]=t.ceil(f),e},wn=new Date,xn=new Date,Tn=q(function(){},function(e,t){e.setTime(+e+t)},function(e,t){return t-e});Tn.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?q(function(t){t.setTime(Math.floor(t/e)*e)},function(t,n){t.setTime(+t+n*e)},function(t,n){return(n-t)/e}):Tn:null};var _n=6e4,Nn=6048e5,Cn=q(function(e){e.setTime(1e3*Math.floor(e/1e3))},function(e,t){e.setTime(+e+1e3*t)},function(e,t){return(t-e)/1e3},function(e){return e.getUTCSeconds()}),Un=q(function(e){e.setTime(Math.floor(e/_n)*_n)},function(e,t){e.setTime(+e+t*_n)},function(e,t){return(t-e)/_n},function(e){return e.getMinutes()}),Dn=q(function(e){var t=e.getTimezoneOffset()*_n%36e5;t<0&&(t+=36e5),e.setTime(36e5*Math.floor((+e-t)/36e5)+t)},function(e,t){e.setTime(+e+36e5*t)},function(e,t){return(t-e)/36e5},function(e){return e.getHours()}),kn=q(function(e){e.setHours(0,0,0,0)},function(e,t){e.setDate(e.getDate()+t)},function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*_n)/864e5},function(e){return e.getDate()-1}),An=E(0),Fn=E(1),Sn=(E(2),E(3),E(4)),Yn=(E(5),E(6),q(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,t){e.setMonth(e.getMonth()+t)},function(e,t){return t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear())},function(e){return e.getMonth()})),Hn=q(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e,t){return t.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});Hn.every=function(e){return isFinite(e=Math.floor(e))&&e>0?q(function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},function(t,n){t.setFullYear(t.getFullYear()+n*e)}):null};var $n=q(function(e){e.setUTCSeconds(0,0)},function(e,t){e.setTime(+e+t*_n)},function(e,t){return(t-e)/_n},function(e){return e.getUTCMinutes()}),Ln=q(function(e){e.setUTCMinutes(0,0,0)},function(e,t){e.setTime(+e+36e5*t)},function(e,t){return(t-e)/36e5},function(e){return e.getUTCHours()}),jn=q(function(e){e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCDate(e.getUTCDate()+t)},function(e,t){return(t-e)/864e5},function(e){return e.getUTCDate()-1}),In=z(0),On=z(1),qn=(z(2),z(3),z(4)),En=(z(5),z(6),q(function(e){e.setUTCDate(1),e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCMonth(e.getUTCMonth()+t)},function(e,t){return t.getUTCMonth()-e.getUTCMonth()+12*(t.getUTCFullYear()-e.getUTCFullYear())},function(e){return e.getUTCMonth()})),zn=q(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)},function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});zn.every=function(e){return isFinite(e=Math.floor(e))&&e>0?q(function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},function(t,n){t.setUTCFullYear(t.getUTCFullYear()+n*e)}):null};var Pn,Zn,Rn,Wn,Vn,Qn={\"-\":\"\",_:\" \",0:\"0\"},Xn=/^\\s*\\d+/,Jn=/^%/,Bn=/[\\\\^$*+?|[\\]().{}]/g;Ge({dateTime:\"%x, %X\",date:\"%-m/%-d/%Y\",time:\"%-I:%M:%S %p\",periods:[\"AM\",\"PM\"],days:[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"],shortDays:[\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"],months:[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],shortMonths:[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"]});Date.prototype.toISOString||Wn(\"%Y-%m-%dT%H:%M:%S.%LZ\"),+new Date(\"2000-01-01T00:00:00.000Z\")||Vn(\"%Y-%m-%dT%H:%M:%S.%LZ\");var Gn=1e3,Kn=60*Gn,er=60*Kn,tr=24*er,nr=7*tr,rr=30*tr,ar=365*tr,ir=function(e){return e.match(/.{6}/g).map(function(e){return\"#\"+e})};ir(\"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf\"),ir(\"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6\"),ir(\"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9\"),ir(\"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5\"),rn(D(300,.5,0),D(-240,.5,1));rn(D(-100,.75,.35),D(80,1.5,.8)),rn(D(260,.75,.35),D(80,1.5,.8)),D();nt(ir(\"44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725\"));nt(ir(\"00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf\")),nt(ir(\"00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4\")),nt(ir(\"0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921\"));var fr=function(e,t,n,r,a){this.node=e,this.x0=t,this.y0=n,this.x1=r,this.y1=a},cr=at.prototype=it.prototype;cr.copy=function(){var e,t,n=new it(this._x,this._y,this._x0,this._y0,this._x1,this._y1),r=this._root;if(!r)return n;if(!r.length)return n._root=ft(r),n;for(e=[{source:r,target:n._root=new Array(4)}];r=e.pop();)for(var a=0;a<4;++a)(t=r.source[a])&&(t.length?e.push({source:t,target:r.target[a]=new Array(4)}):r.target[a]=ft(t));return n},cr.add=function(e){var t=+this._x.call(null,e),n=+this._y.call(null,e);return rt(this.cover(t,n),t,n,e)},cr.addAll=function(e){var t,n,r,a,i=e.length,f=new Array(i),c=new Array(i),u=1/0,o=1/0,s=-1/0,l=-1/0;for(n=0;n<i;++n)isNaN(r=+this._x.call(null,t=e[n]))||isNaN(a=+this._y.call(null,t))||(f[n]=r,c[n]=a,r<u&&(u=r),r>s&&(s=r),a<o&&(o=a),a>l&&(l=a));for(s<u&&(u=this._x0,s=this._x1),l<o&&(o=this._y0,l=this._y1),this.cover(u,o).cover(s,l),n=0;n<i;++n)rt(this,f[n],c[n],e[n]);return this},cr.cover=function(e,t){if(isNaN(e=+e)||isNaN(t=+t))return this;var n=this._x0,r=this._y0,a=this._x1,i=this._y1;if(isNaN(n))a=(n=Math.floor(e))+1,i=(r=Math.floor(t))+1;else{if(!(n>e||e>a||r>t||t>i))return this;var f,c,u=a-n,o=this._root;switch(c=(t<(r+i)/2)<<1|e<(n+a)/2){case 0:do{f=new Array(4),f[c]=o,o=f}while(u*=2,a=n+u,i=r+u,e>a||t>i);break;case 1:do{f=new Array(4),f[c]=o,o=f}while(u*=2,n=a-u,i=r+u,n>e||t>i);break;case 2:do{f=new Array(4),f[c]=o,o=f}while(u*=2,a=n+u,r=i-u,e>a||r>t);break;case 3:do{f=new Array(4),f[c]=o,o=f}while(u*=2,n=a-u,r=i-u,n>e||r>t)}this._root&&this._root.length&&(this._root=o)}return this._x0=n,this._y0=r,this._x1=a,this._y1=i,this},cr.data=function(){var e=[];return this.visit(function(t){if(!t.length)do{e.push(t.data)}while(t=t.next)}),e},cr.extent=function(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},cr.find=function(e,t,n){var r,a,i,f,c,u,o,s=this._x0,l=this._y0,h=this._x1,d=this._y1,b=[],g=this._root;for(g&&b.push(new fr(g,s,l,h,d)),null==n?n=1/0:(s=e-n,l=t-n,h=e+n,d=t+n,n*=n);u=b.pop();)if(!(!(g=u.node)||(a=u.x0)>h||(i=u.y0)>d||(f=u.x1)<s||(c=u.y1)<l))if(g.length){var p=(a+f)/2,y=(i+c)/2;b.push(new fr(g[3],p,y,f,c),new fr(g[2],a,y,p,c),new fr(g[1],p,i,f,y),new fr(g[0],a,i,p,y)),(o=(t>=y)<<1|e>=p)&&(u=b[b.length-1],b[b.length-1]=b[b.length-1-o],b[b.length-1-o]=u)}else{var v=e-+this._x.call(null,g.data),M=t-+this._y.call(null,g.data),m=v*v+M*M;if(m<n){var w=Math.sqrt(n=m);s=e-w,l=t-w,h=e+w,d=t+w,r=g.data}}return r},cr.remove=function(e){if(isNaN(i=+this._x.call(null,e))||isNaN(f=+this._y.call(null,e)))return this;var t,n,r,a,i,f,c,u,o,s,l,h,d=this._root,b=this._x0,g=this._y0,p=this._x1,y=this._y1;if(!d)return this;if(d.length)for(;;){if((o=i>=(c=(b+p)/2))?b=c:p=c,(s=f>=(u=(g+y)/2))?g=u:y=u,t=d,!(d=d[l=s<<1|o]))return this;if(!d.length)break;(t[l+1&3]||t[l+2&3]||t[l+3&3])&&(n=t,h=l)}for(;d.data!==e;)if(r=d,!(d=d.next))return this;return(a=d.next)&&delete d.next,r?(a?r.next=a:delete r.next,this):t?(a?t[l]=a:delete t[l],(d=t[0]||t[1]||t[2]||t[3])&&d===(t[3]||t[2]||t[1]||t[0])&&!d.length&&(n?n[h]=d:this._root=d),this):(this._root=a,this)},cr.removeAll=function(e){for(var t=0,n=e.length;t<n;++t)this.remove(e[t]);return this},cr.root=function(){return this._root},cr.size=function(){var e=0;return this.visit(function(t){if(!t.length)do{++e}while(t=t.next)}),e},cr.visit=function(e){var t,n,r,a,i,f,c=[],u=this._root;for(u&&c.push(new fr(u,this._x0,this._y0,this._x1,this._y1));t=c.pop();)if(!e(u=t.node,r=t.x0,a=t.y0,i=t.x1,f=t.y1)&&u.length){var o=(r+i)/2,s=(a+f)/2;(n=u[3])&&c.push(new fr(n,o,s,i,f)),(n=u[2])&&c.push(new fr(n,r,s,o,f)),(n=u[1])&&c.push(new fr(n,o,a,i,s)),(n=u[0])&&c.push(new fr(n,r,a,o,s))}return this},cr.visitAfter=function(e){var t,n=[],r=[];for(this._root&&n.push(new fr(this._root,this._x0,this._y0,this._x1,this._y1));t=n.pop();){var a=t.node;if(a.length){var i,f=t.x0,c=t.y0,u=t.x1,o=t.y1,s=(f+u)/2,l=(c+o)/2;(i=a[0])&&n.push(new fr(i,f,c,s,l)),(i=a[1])&&n.push(new fr(i,s,c,u,l)),(i=a[2])&&n.push(new fr(i,f,l,s,o)),(i=a[3])&&n.push(new fr(i,s,l,u,o))}r.push(t)}for(;t=r.pop();)e(t.node,t.x0,t.y0,t.x1,t.y1);return this},cr.x=function(e){return arguments.length?(this._x=e,this):this._x},cr.y=function(e){return arguments.length?(this._y=e,this):this._y},e.scaleUtc=function(){return tt(zn,En,In,jn,Ln,$n,Cn,Tn,Wn).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)])},e.scaleTime=function(){return tt(Hn,Yn,An,kn,Dn,Un,Cn,Tn,Zn).domain([new Date(2e3,0,1),new Date(2e3,0,2)])},e.scaleLinear=O,e.scaleBand=f,e.scalePoint=function(){return c(f().paddingInner(1))},e.quadtree=at,Object.defineProperty(e,\"__esModule\",{value:!0})});var extentCalc={};extentCalc._defaultScaleValue={x:[Infinity,-Infinity],y:[Infinity,-Infinity]};extentCalc.determineExtents=function determineExtents(data){var xOrd=this.xAxisType===\"ordinal\"||this.xAxisType===\"scaleBand\",yOrd=this.yAxisType===\"ordinal\"||this.yAxisType===\"scaleBand\",xTime=this.xAxisType===\"time\"||this.xAxisType===\"timeLocal\",doX=xTime?false:true,doY=true,keys=Object.keys(this.completeSeriesConfig),extents={x:[],y:[]};extents.x=this._checkForExtents(xOrd,this.chartExtents,this.dataExtents,\"x\");extents.y=this.axes&&this.axes.length?this._calcMultiAxisExtents(data):this._checkForExtents(yOrd,this.chartExtents,this.dataExtents,\"y\");if(extents.x.length>0&&extents.x[0]!==Infinity&&extents.x[1]!==-Infinity){xTime=false;doX=false}if(!Array.isArray(extents.y)||extents.y.length>0&&extents.y[0]!==Infinity&&extents.y[1]!==-Infinity){doY=false}if(data.length===0){xTime=false;doX=false;doY=false}if(doX||doY||xTime){this._findMinMax(data,doX,doY,xOrd,yOrd,xTime,extents,keys)}if(extents.x[0]===Infinity){extents.x[0]=0}if(extents.x[1]===-Infinity){extents.x[1]=1}if(Array.isArray(extents.y)&&extents.y[0]===Infinity){extents.y[0]=0}if(Array.isArray(extents.y)&&extents.y[1]===-Infinity){extents.y[1]=1}if(extents.x[1]===extents.x[0]){extents.x[0]-=.5;extents.x[1]+=.5}if(Array.isArray(extents.y)){if(extents.y[1]===extents.y[0]){extents.y[0]-=.5;extents.y[1]+=.5}}else{var yKeys=Object.keys(extents.y);for(var i=0;i<yKeys.length;i++){if(extents.y[yKeys[i]][0]===extents.y[yKeys[i]][1]){extents.y[yKeys[i]][0]-=.5;extents.y[yKeys[i]][1]+=.5}}}return extents}.bind(extentCalc);extentCalc._checkForExtents=function _checkForExtents(isOrd,chartExtents,dataExtents,axis){var exts=[];if(isOrd){if(dataExtents&&dataExtents[axis]){exts=JSON.parse(JSON.stringify(dataExtents[axis]))}if(chartExtents&&chartExtents[axis]){exts=JSON.parse(JSON.stringify(chartExtents[axis]))}}else{var fromChartExtents=false;exts=this._checkChartExtents(chartExtents,axis);fromChartExtents=exts.length===2?true:false;exts=this._checkDataExtents(dataExtents,chartExtents,axis,fromChartExtents,exts);if(exts.length<2){exts=[this._defaultScaleValue[axis][0],this._defaultScaleValue[axis][1]]}}return exts}.bind(extentCalc);extentCalc._checkChartExtents=function _checkChartExtents(cExts,axis){var exts=[];if(cExts&&cExts[axis]&&cExts[axis].length===2){exts[0]=cExts[axis][0]===\"dynamic\"?Infinity:cExts[axis][0];exts[1]=cExts[axis][1]===\"dynamic\"?-Infinity:cExts[axis][1]}return exts}.bind(extentCalc);extentCalc._checkDataExtents=function _checkDataExtents(dExts,cExts,axis,bool,exts){var result=exts||[];if(dExts&&dExts[axis]&&dExts[axis].length===2){if(bool){result[0]=cExts[axis][0]===\"dynamic\"?dExts[axis][0]:cExts[axis][0];result[1]=cExts[axis][1]===\"dynamic\"?dExts[axis][1]:cExts[axis][1]}else{result[0]=Math.min(dExts[axis][0],this._defaultScaleValue[axis][0]);result[1]=Math.max(dExts[axis][1],this._defaultScaleValue[axis][1])}}return result}.bind(extentCalc);extentCalc._findMinMax=function _findMinMax(data,doX,doY,ordX,ordY,timeX,result,keys){var xVal,yVal,dLen=data.length,x=this.completeSeriesConfig[keys[0]].x,y=this.completeSeriesConfig[keys[0]].y,doX0=!ordX&&result.x[0]===Infinity?true:false,doX1=!ordX&&result.x[1]===-Infinity?true:false,doY0=!ordY&&result.y[0]===Infinity?true:false,doY1=!ordY&&result.y[1]===-Infinity?true:false;if(timeX){this._findTimeMM(result,data,dLen,x,doX0,doX1)}if(doX||doY){for(var i=0;i<dLen;i++){xVal=this._getDataExtents(data[i],keys,\"x\");yVal=this._getDataExtents(data[i],keys,\"y\");if(doX){this._processDataValues(ordX,result,data,\"x\",x,i,doX0,doX1,xVal[0],xVal[1])}if(doY){this._processDataValues(ordY,result,data,\"y\",y,i,doY0,doY1,yVal[0],yVal[1])}}}}.bind(extentCalc);extentCalc._getDataExtents=function _getDataExtents(d,keysArr,axis){var a=[];for(var i=0;i<keysArr.length;i++){var key=keysArr[i],val;if(!this.mutedSeries[keysArr[i]]){val=d[this.completeSeriesConfig[key][axis]];if(val||val===0){a.push(val)}}}return[Math.min.apply(null,a),Math.max.apply(null,a)]}.bind(extentCalc);extentCalc._findTimeMM=function _findTimeMM(result,d,l,x,doMin,doMax){if(doMin){this._setMin(result.x,d[0][x])}if(doMax){this._setMax(result.x,d[l-1][x])}}.bind(extentCalc);extentCalc._setMin=function _setMin(r,d){if(d===null){return}if(isNaN(r[0])||r[0]>d){r[0]=d}}.bind(extentCalc);extentCalc._setMax=function _setMax(r,d){if(d===null){return}if(isNaN(r[1])||r[1]<d){r[1]=d}}.bind(extentCalc);extentCalc._processDataValues=function _processDataValues(isOrd,r,d,axis,key,i,doMin,doMax,v0,v1){if(isOrd){if(r[axis].indexOf(d[i][key])===-1){r[axis].push(d[i][key])}}else{if(doMin){this._setMin(r[axis],v0)}if(doMax){this._setMax(r[axis],v1)}}}.bind(extentCalc);extentCalc._checkInSeriesConfig=function _checkInSeriesConfig(exts,a){for(var i=0;i<this.seriesToAxes[a].length;i++){var s=this.seriesToAxes[a][i];if(!this.hardMute||!this.mutedSeries[s]){exts[a][0]=this.completeSeriesConfig[s][\"yMin\"]||this.completeSeriesConfig[s][\"yMin\"]===0?Math.min(this.completeSeriesConfig[s][\"yMin\"],exts[a][0]):exts[a][0];exts[a][1]=this.completeSeriesConfig[s][\"yMax\"]||this.completeSeriesConfig[s][\"yMax\"]===0?Math.max(this.completeSeriesConfig[s][\"yMax\"],exts[a][1]):exts[a][1]}}}.bind(extentCalc);extentCalc._applyChartExtents=function _applyChartExtents(exts,a){var k=this.chartExtents[a]?a:\"y\";if(this.chartExtents[k]){if(this.chartExtents[k][0]===\"dynamic\"){exts[a][0]=exts[a][0]||exts[a][0]===0?exts[a][0]:Infinity}else{exts[a][0]=this.chartExtents[k][0]}if(this.chartExtents[k][1]===\"dynamic\"){exts[a][1]=exts[a][1]||exts[a][1]===0?exts[a][1]:-Infinity}else{exts[a][1]=this.chartExtents[k][1]}}}.bind(extentCalc);extentCalc._searchForExtents=function _searchForExtents(exts,seriesToSearch,data){var seriesList=Object.keys(seriesToSearch);for(var i=0;i<data.length;i++){for(var j=0;j<seriesList.length;j++){var s=seriesList[j],sY=this.completeSeriesConfig[s][\"y\"],series=seriesToSearch[s],axis=series[\"axis\"];if(series.min&&(data[i][sY]||data[i][sY]===0)){exts[axis][0]=Math.min(data[i][sY],exts[axis][0])}if(series.max&&(data[i][sY]||data[i][sY]===0)){exts[axis][1]=Math.max(data[i][sY],exts[axis][1])}}}}.bind(extentCalc);extentCalc._calcSeriesToSearch=function _calcSeriesToSearch(exts,a,seriesToSearch){for(var i=0;i<this.seriesToAxes[a].length;i++){var s=this.seriesToAxes[a][i];if(!this.hardMute||!this.mutedSeries[s]){seriesToSearch[s]={axis:a,min:exts[a][0]===Infinity?true:false,max:exts[a][1]===-Infinity?true:false}}}}.bind(extentCalc);extentCalc._calcMultiAxisExtents=function _calcMultiAxisExtents(data){var search=false,exts={},seriesToSearch={},a,keys;for(var i=0;i<this.axes.length;i++){a=this.axes[i];exts[a]=[];exts[a][0]=this._defaultScaleValue.y[0];exts[a][1]=this._defaultScaleValue.y[1];this._checkInSeriesConfig(exts,a);if(this.chartExtents){this._applyChartExtents(exts,a)}if(exts[a][0]===Infinity||exts[a][1]===-Infinity){search=true;this._calcSeriesToSearch(exts,a,seriesToSearch)}}if(search){this._searchForExtents(exts,seriesToSearch,data)}keys=Object.keys(exts);for(var i=0;i<keys.length;i++){if(exts[keys[i]][0]===Infinity||exts[keys[i]][1]===-Infinity){exts[keys[i]]=[0,1]}}return exts}.bind(extentCalc);var dataMapping={},quadtrees={};function reply(data,time){var time2=null;postMessage({data:data,timeIn:time,timeOut:time2})}function updateData(eventData,time){dataMapping[eventData.chartId]=eventData.data.chartData;reply(null,time)}function deleteData(eventData,time){delete dataMapping[eventData.chartId];delete quadtrees[eventData.chartId];reply(null,time)}function recreateD3Scale(scaleObj){var result;if(scaleObj.type===\"time\"){result=d3.scaleUtc().nice().range(scaleObj.range).domain(scaleObj.domain)}else if(scaleObj.type===\"timeLocal\"){result=d3.scaleTime().nice().range(scaleObj.range).domain(scaleObj.domain)}else if(scaleObj.type===\"linear\"){result=d3.scaleLinear().nice().range(scaleObj.range).domain(scaleObj.domain)}else if(scaleObj.type===\"scaleBand\"){result=d3.scaleBand().range(scaleObj.range).domain(scaleObj.domain).round(true).paddingInner(.5)}else{result=d3.scalePoint().range(scaleObj.range).domain(scaleObj.domain).padding(.5)}return result}function getMultiScale(visData){var o={},k,axis;for(var i=0;i<visData.keys.length;i++){k=visData.keys[i];axis=visData.isMultiY?visData.completeSeriesConfig[k][\"axis\"][\"id\"]:\"defaultAxis\";if(!o[axis]){o[axis]=recreateD3Scale(visData.y[axis])}}return o}function createDataStub(){return{time:null,timeSeriesKey:null,series:[],rawData:[],timeStamps:[],timeStampsTracker:{}}}function flattenData(visData,d,xScale,yScale,index,arr){for(var i=0;i<visData.keys.length;i++){var o={},k=visData.keys[i],axis=visData.completeSeriesConfig[k][\"axis\"]?visData.completeSeriesConfig[k][\"axis\"][\"id\"]:\"default\";o[\"i\"]=index;o[\"k\"]=k;if(visData.radial){var pix=calcPixelCoordForRadial(d[visData.completeSeriesConfig[k][\"x\"]],d[visData.completeSeriesConfig[k][\"y\"]],axis,visData);o[\"px\"]=~~pix[0];o[\"py\"]=~~pix[1]}else{o[\"px\"]=~~xScale(d[visData.completeSeriesConfig[k][\"x\"]],axis);o[\"py\"]=~~yScale(d[visData.completeSeriesConfig[k][\"y\"]],axis)}arr.push(o)}return arr}function buildQuadtreeHelperObj(visData,k,index,xScale){var obj={},axis=visData.completeSeriesConfig[k][\"axis\"]?visData.completeSeriesConfig[k][\"axis\"][\"id\"]:null;obj.xKey=visData.completeSeriesConfig[k][\"x\"];obj.yKey=visData.completeSeriesConfig[k][\"y\"];if(visData.radial){var calcPx=function(d){return calcPixelCoordForRadial(d[obj.xKey],d[obj.yKey],axis,visData)};obj.xScale=function(d){return calcPx(d)[0]};obj.yScale=function(d){return calcPx(d)[1]};obj.yScale.index=index}else{obj.yScale=recreateD3Scale(visData.y[axis]);obj.yScale.index=index;obj.xScale=recreateD3Scale(visData.x)}return obj}function adjustAngleForPolarChart(angle,toDegrees,visData){var offset=toDegrees?180:Math.PI;if(!visData.counterClockwise&&!toDegrees||visData.counterClockwise&&toDegrees){angle*=-1}if(visData.useDegrees){if(toDegrees){return angle+offset}else{return angle/360*2*Math.PI+offset}}else{if(toDegrees){return angle/(2*Math.PI)*360+offset}else{return angle+offset}}}function calcPixelCoordForRadial(angle,amp,axis,visData){var yRange=visData.y[axis].range[1]-visData.y[axis].range[0],yDomainTot=visData.y[axis].domain[1]-visData.y[axis].domain[0],pixelAmplitude=yRange*(amp-visData.y[axis].domain[0])/yDomainTot;angle=adjustAngleForPolarChart(angle,false,visData);return[Math.sin(angle)*pixelAmplitude,Math.cos(angle)*pixelAmplitude]}function calcXScale(visData){if(!visData.radial){var x=recreateD3Scale(visData.x);return function(d){return x(d)}}}function calcYScale(visData){if(!visData.radial){var y=getMultiScale(visData);return function(d,axis){return y[axis](d)}}}function createSingleQuadtree(data){var visData=data.data,chartData=dataMapping[data.chartId],flatData,xScale=calcXScale(visData),yScale=calcYScale(visData),quadtree;if(chartData){quadtree=d3.quadtree().extent(visData.extents).x(function(d){return d.px}).y(function(d){return d.py});var during,allFlat=[];for(var i=0;i<chartData.length;i++){flattenData(visData,chartData[i],xScale,yScale,i,allFlat)}quadtree.addAll(allFlat);return quadtree}else{return null}}function createSeriesQuadtree(data){var visData=data.data,chartData=dataMapping[data.chartId],k,quadtree={},xScale=function(d){return visData.radial?this.xScale(d):this.xScale(d[this.xKey])},yScale=function(d){return visData.radial?this.yScale(d):this.yScale(d[this.yKey])};if(chartData){for(var i=0;i<visData.keys.length;i++){k=visData.keys[i];var obj=buildQuadtreeHelperObj(visData,k,i);quadtree[k]=d3.quadtree().extent(visData.extents).x(xScale.bind(obj)).y(yScale.bind(obj)).addAll(chartData)}return quadtree}else{return null}}function createQuadtree(data,time){quadtrees[data.chartId]=data.data.searchType===\"pointPerSeries\"?createSeriesQuadtree(data):createSingleQuadtree(data);reply(null,time)}function _getPixelSpaceVal(d,chartScale,key,axis){return axis?chartScale[axis](d[key]):chartScale(d[key])}function calcValueQuadtree(d,x,y){var o={};o[x]=d[x];o[y]=d[y];return o}function calcCoordQuadtree(d,x,y,xScale,yScale,visData,axis){var a=[];if(visData.radial){a=calcPixelCoordForRadial(d[x],d[y],axis,visData)}else{a[0]=xScale(d[x]);a[1]=yScale(d[y])}return a}function calcDataSeriesQuadtree(d,k,xScale,yScale,visData,axis){var x=visData.completeSeriesConfig[k][\"x\"],y=visData.completeSeriesConfig[k][\"y\"];return{coord:calcCoordQuadtree(d,x,y,xScale,yScale,visData,axis),name:k,value:calcValueQuadtree(d,x,y)}}function calcClosestPoint(mousePos,foundPoint,series,time){var pixelX=series.coord[0],pixelY=series.coord[1],currDist=(pixelX-=mousePos[0])*pixelX+(pixelY-=mousePos[1])*pixelY;if(!foundPoint||foundPoint.dist>currDist){return{dist:currDist,time:time,key:series.name}}return foundPoint}function calcDataSingleQuadtree(rawData,k,visData){var x=visData.completeSeriesConfig[k][\"x\"],y=visData.completeSeriesConfig[k][\"y\"],axis=visData.completeSeriesConfig[k][\"axis\"]?visData.completeSeriesConfig[k][\"axis\"][\"id\"]:\"default\",value=calcValueQuadtree(rawData,x,y);return{coord:visData.radial?calcPixelCoordForRadial(value[x],value[y],axis,visData):[visData.xScale(value[x]),visData.yScale[axis](value[y])],name:k,value:value}}function addCrosshairDataQuadtree(dataObj,d,timeData){if(timeData&&!dataObj.timeStampsTracker[d[timeData]]){dataObj.rawData.push(d);dataObj.timeStamps.push(d[timeData]);dataObj.timeStampsTracker[d[timeData]]=true}else if(!timeData){dataObj.rawData.push(d)}return dataObj}function constructDataObj(result,dataObj,k,visData,isSingle,xScale){if(!result){dataObj.series.push(emptySeries(k))}else if(isSingle){var rawData=this.dataMapping[visData.chartId][result.i];dataObj.series.push(calcDataSingleQuadtree(rawData,k,visData));if(visData.calcCrosshair&&visData.searchType!==\"allInArea\"){dataObj=addCrosshairDataQuadtree(dataObj,rawData,visData.timeData)}}else{var axis=visData.completeSeriesConfig[k][\"axis\"][\"id\"],yScale=recreateD3Scale(visData.y[axis]),series=calcDataSeriesQuadtree(result,k,xScale,yScale,visData,axis);dataObj.series.push(series);if(visData.timeData){dataObj.closest=calcClosestPoint(visData.mousePos,dataObj.closest,series,result[visData.timeData])}if(visData.calcCrosshair){dataObj=addCrosshairDataQuadtree(dataObj,result,visData.timeData)}}return dataObj}function calcBoxSize(visData){var x0=visData.mousePos[0]-visData.radius,x1=visData.mousePos[0]+visData.radius,y0=visData.mousePos[1]-visData.radius,y1=visData.mousePos[1]+visData.radius;return{x0:x0,x1:x1,y0:y0,y1:y1}}function calcPolygonExtents(polygon){var xExt=d3.extent(polygon,function(d){return d[0]}),yExt=d3.extent(polygon,function(d){return d[1]});return{x0:xExt[0],x1:xExt[1],y0:yExt[0],y1:yExt[1]}}function searchPolygonQuadtree(visData,dataObj,quadtree){var boxSize=calcPolygonExtents(visData.polygon),scanned=0,selected=0;if(visData.polygon.length){quadtree.visit(function(node,nodeX0,nodeY0,nodeX1,nodeY1){if(!node.length){do{var d=node.data;scanned++;if(d3.polygonContains(visData.polygon,[d.px,d.py])){dataObj=addCrosshairDataQuadtree(dataObj,this.dataMapping[visData.chartId][node.data.i],visData.timeData);selected++}}while(node=node.next);return true}return nodeX0>=boxSize.x1||nodeY0>=boxSize.y1||nodeX1<boxSize.x0||nodeY1<boxSize.y0})}return dataObj}function searchAreaBoxQuadtree(quadtree,visData,dataObj){var boxSize=calcBoxSize(visData);quadtree.visit(function(node,nodeX0,nodeY0,nodeX1,nodeY1){if(!node.length){do{var d=node.data;if(d.px>=boxSize.x0&&d.px<boxSize.x1&&d.py>=boxSize.y0&&d.py<boxSize.y1){dataObj=addCrosshairDataQuadtree(dataObj,d.data,visData.timeData)}}while(node=node.next)}return nodeX0>=boxSize.x1||nodeY0>=boxSize.y1||nodeX1<boxSize.x0||nodeY1<boxSize.y0});return dataObj}function searchAreaRadiusQuadtree(quadtree,visData,dataObj){var r2=visData.radius*visData.radius,boxSize=calcBoxSize(visData);quadtree.visit(function(node,nodeX0,nodeY0,nodeX1,nodeY1){if(!node.length){do{if(!visData.hardMute||!visData.mutedSeries[node.data.k]){if(Math.pow(node.data.px-visData.mousePos[0],2)+Math.pow(node.data.py-visData.mousePos[1],2)<=r2){dataObj=addCrosshairDataQuadtree(dataObj,this.dataMapping[visData.chartId][node.data.i],visData.timeData)}}}while(node=node.next)}return nodeX0>=boxSize.x1||nodeY0>=boxSize.y1||nodeX1<boxSize.x0||nodeY1<boxSize.y0});return dataObj}function searchAreaQuadtree(quadtree,visData,dataObj){return visData.radius?searchAreaRadiusQuadtree(quadtree,visData,dataObj):searchAreaBoxQuadtree(quadtree,visData,dataObj)}function searchQuadtreePolygon(visData,dataObj,quadtreeData){}function searchQuadtreeSingle(visData,dataObj,quadtreeData){var r=visData.radius?visData.radius:Infinity,result=quadtreeData.find(visData.mousePos[0],visData.mousePos[1],r),k;for(var i=0;i<visData.keys.length;i++){k=visData.keys[i];if(!visData.hardMute||!visData.mutedSeries[k]){dataObj=constructDataObj(result,dataObj,k,visData,true,null)}}if(visData.calcCrosshair){if(visData.searchType===\"allInArea\"){dataObj=searchAreaRadiusQuadtree(quadtreeData,visData,dataObj)}else if(visData.searchType===\"lasso\"){dataObj=searchPolygonQuadtree(quadtreeData,visData,dataObj)}}if(result){dataObj.time=dataMapping[visData.chartId][result.i][visData.timeData];dataObj.timeSeriesKey=result.k}return dataObj}function searchQuadtreeSeries(visData,dataObj,quadtreeData){var r=visData.radius?visData.radius:Infinity,xScale=!visData.radial?recreateD3Scale(visData.x):null,result,k;for(var i=0;i<visData.keys.length;i++){k=visData.keys[i];if(!visData.hardMute||!visData.mutedSeries[k]){result=quadtreeData[k].find(visData.mousePos[0],visData.mousePos[1],r);dataObj=constructDataObj(result,dataObj,k,visData,false,xScale)}}if(dataObj.closest){dataObj.time=dataObj.closest.time;dataObj.timeSeriesKey=dataObj.closest.key;delete dataObj.closest}return dataObj}function returnClosestsQuadtreePoints(eventData,time){var visData=eventData.data,dataObj=createDataStub(),quadtreeData=quadtrees[eventData.chartId];visData.chartId=eventData.chartId;visData.xScale=recreateD3Scale(visData.x);visData.yScale=getMultiScale(visData);if(quadtreeData){if(visData.searchType===\"pointPerSeries\"){dataObj=searchQuadtreeSeries(visData,dataObj,quadtreeData)}else if(visData.searchType===\"lasso\"){dataObj=searchPolygonQuadtree(visData,dataObj,quadtreeData)}else{dataObj=searchQuadtreeSingle(visData,dataObj,quadtreeData)}}delete dataObj.timeStampsTracker;reply(dataObj,time)}function returnQuadtreePointsInArea(eventData,time){var visData=eventData.data,quadtreeData=quadtrees[eventData.chartId],dataObj=createDataStub();if(quadtreeData){dataObj=searchAreaBoxQuadtree(quadtreeData,visData,dataObj)}reply(dataObj,time)}function emptySeries(k){return{coord:[],name:k,value:{}}}function addCrosshairData(dataObj,d){if(this.timeData&&!dataObj.timeStampsTracker[d[this.timeData]]){dataObj.rawData.push(d);dataObj.timeStamps.push(d[this.timeData]);dataObj.timeStampsTracker[d[this.timeData]]=true}else if(!this.timeData){dataObj.rawData.push(d)}return dataObj}function determineExtents(eventData,time){var visData=eventData.data,extents=null;extentCalc.xAxisType=visData.xAxisType;extentCalc.yAxisType=visData.yAxisType;extentCalc.completeSeriesConfig=visData.completeSeriesConfig;extentCalc.chartExtents=visData.chartExtents;extentCalc.dataExtents=visData.dataExtents;extentCalc.axes=visData.axes;extentCalc.seriesToAxes=visData.seriesToAxes;extentCalc.isYAxisObject=visData.isYAxisObject;extentCalc.mutedSeries=visData.mutedSeries;extentCalc.hardMute=visData.hardMute;if(dataMapping[eventData.chartId]){extents=extentCalc.determineExtents(dataMapping[eventData.chartId])}reply(extents,time)}onmessage=function(e){var time=null;switch(e.data.action){case\"registerCustomScript\":if(e.data.data.url){importScripts(e.data.data.url)}reply(null,time);break;case\"runCustomFunction\":var obj=this[e.data.data.objectName],func,result;if(obj){func=obj[e.data.data.functionName];if(func){result=func(e.data.data.data,e.data.chartId)}else{throw\"Couldn't run custom function \"+e.data.data.functionName+\" on custom Object \"+e.data.data.objectName+\" because the specified function doesn't exist on the specified Object.\"}}else{throw\"Couldn't run custom function \"+e.data.data.functionName+\" on custom Object \"+e.data.data.objectName+\" because the specified Object doesn't exist. Make sure you have loaded your custom script defining the custom object.\"}reply(result,time);break;case\"updateData\":updateData(e.data,time);break;case\"createQuadtree\":createQuadtree(e.data,time);break;case\"findQuadtreePoints\":returnClosestsQuadtreePoints(e.data,time);break;case\"findQuadtreePointsInArea\":returnQuadtreePointsInArea(e.data,time);break;case\"returnQuadtreeData\":reply(quadtrees[e.data.chartId],time);break;case\"determineExtents\":determineExtents(e.data,time);break;case\"unregisterChart\":deleteData(e.data,time);break;default:reply(null,time)}};"}; 
      //end of blob
      Px.vis.workerUrl = window.URL.createObjectURL(new Blob([blob.script]));
    }

    scheduler.workers = [];
    scheduler.queue = [];
    //mapping between chart and webworker: {chartId: webWorkerIndex}
    scheduler.chartWorkerMapping = {};
    scheduler.hasChartData = {};

    //each chart will always use the same web worker. This is to get around
    //the problem of passing a lot of data around, so the thread will have
    //to keep the data for charts in sync
    getWorkerIndexForChart = function(chartId) {

      //if this chart  hasn't been registered yet do it
      if(!scheduler.chartWorkerMapping[chartId] && scheduler.chartWorkerMapping[chartId] !== 0) {
        //crudely "balance" workload by distributing charts equally among threads.
        var mappingKeys = Object.keys(scheduler.chartWorkerMapping),
            workerChartCount = [],
            minCount = Number.MAX_VALUE,
            workerIndex = 0;

        for(var k=0; k<scheduler.workers.length; k++) {
          workerChartCount.push(0);
        }

        for(var i=0; i<mappingKeys.length; i++) {
          //count the number of charts for each worker
            workerChartCount[scheduler.chartWorkerMapping[mappingKeys[i]]]++;
        }

        //pick the web worker with the least charts
        for(var j=0; j<workerChartCount.length; j++) {
          if(workerChartCount[j] < minCount) {
            minCount = workerChartCount[j];
            workerIndex = j;
          }
        }

        //finally assign the worker index for the chart
        scheduler.chartWorkerMapping[chartId] = workerIndex;
      }

      return scheduler.chartWorkerMapping[chartId];
    }

    startWork = function(worker, ctx) {
      worker.inUse = true;

      //don't copy the callback around, just remember it
      worker.ctx = {};
      worker.ctx.successCallback = ctx.successCallback;
      worker.ctx.errorCallback = ctx.errorCallback;
      worker.ctx.action = ctx.action;
      worker.ctx.chartId = ctx.chartId;
      worker.ctx.originatorName = ctx.originatorName;

      window.dispatchEvent(new CustomEvent('px-vis-scheduler-work-start', {'detail': { 'action': ctx.action, 'data': ctx.data, 'chartId': ctx.chartId, 'originatorName': ctx.originatorName}}));

      worker.postMessage({ 'action': ctx.action, 'data': ctx.data, 'chartId': ctx.chartId});
    }

    /**
     * Method to request some work from the web worker. The context object
     * can have the following properties:
     * - action: action to be run in the webworker. See below for list of actions
     * - originatorName: arbitrary string representing who sent the request
     * - chartId: Id of the chart this request relates to. Used to identify which webworker to use and what dataset to use in the webworker
     * - successCallback (optional): callback after successfully running an action in the webworker. The callback will have one parameter holding the result of that action
     * - errorCallback (optional): Callback after an error has been fired during the webworker.
     *
     * Please note successCallback and errorCallback are mutually exclusive:
     * one will be called or the other. If both are defined you are guaranteed
     * to have feedback on your request
     *
     * Each request is uniquely identified through the triplet "action
     * originatorName chartId". When a webworker is busy and a request comes
     * in for this webworker then the request will be queued. If another
     * request with the same triplet identifier comes in it will trump the
     * previously queued request: the request initially queued will be
     * destroyed and the new one will be queued
     *
     * The current list of significant actions is as follows (more can be
     * found by inspecting px-vis-worker.js but are usually meant to be used
     * internally):
     * - runCustomFunction: used to run a function on a custom script that you
 explicitely loaded in the web workers through Px.vis.registerCustomScript. Pass "functionName" and "objectName" in the "data" object of the context
     * - updateData: register a new dataset or update a dataset in the web worker. It will be stored in the dataMapping object, the key being chartId and the value the dataset. pass "chartData" in the data object
     *
     */
    scheduler.process = function(context) {

      //find worker for this chart
      var worker = scheduler.workers[getWorkerIndexForChart(context.chartId)]

      startOrQueueWork(context, worker);
    };

    startOrQueueWork = function(context, worker) {
      // check if we have run updateData before so we can stick stuff in a queue if not
      var hasData = scheduler.hasChartData[context.chartId] ?
      scheduler.hasChartData[context.chartId] : (context.action === 'updateData');

      //start work or queue
      if(!worker.inUse && hasData || context.action === 'unregisterChart') {

        scheduler.hasChartData[context.chartId] = hasData;
        startWork(worker, context);

      } else {
        //worker not available, queue
        var obj,
            found;

        //if we already have an action of this type for this chart remove the old one and replace it with this one
        for(var i=0; i<scheduler.queue[worker.index].length; i++) {

          var obj = scheduler.queue[worker.index][i];
          if(obj.chartId === context.chartId && obj.action === context.action && obj.originatorName === context.originatorName) {
            found = i;
            break;
          }
        }

        if(found || found === 0) {
          scheduler.queue[worker.index].splice(found, 1);
        }

        //now queue
        scheduler.queue[worker.index].push(context);
      }
    };

    //called once a worker has finished a piece of work
    processDone = function(e) {

      window.dispatchEvent(new CustomEvent('px-vis-scheduler-work-end', {'detail': { 'action': this.ctx.action, 'data': e.data.data, 'chartId': this.ctx.chartId, 'originatorName': this.ctx.originatorName}}));

      //store callback and kick off new work before processing results
      var callback = this.ctx.successCallback;

      //cleanup if chart has been unregistered
      if(this.ctx.action === 'unregisterChart') {
        //TODO: clean queues in case something has been added while deleting?
        delete scheduler.chartWorkerMapping[this.ctx.chartId];
        delete scheduler.hasChartData[this.ctx.chartId];

        //clear everything related to this chart
        scheduler.queue[this.index] = scheduler.queue[this.index].filter(function(elem) {
          return elem.chartId !== this.ctx.chartId;
        }.bind(this));
      }

      this.inUse = false;

      //use thread if work queued
      if(scheduler.queue[this.index].length) {

        //get and do work
        var ctx = scheduler.queue[this.index].splice(0, 1)[0];
        startOrQueueWork(ctx, this);
      }

      //run callback with the result
      if(callback) {
        callback(e.data);
      }
    };

    webWorkerError = function(e) {

      window.dispatchEvent(new CustomEvent('px-vis-scheduler-work-error', { 'detail': { 'action': this.ctx.action, 'chartId': this.ctx.chartId, 'originatorName': this.ctx.originatorName}}));

      //cleanup if chart has been unregistered
      if(this.ctx.action === 'unregisterChart') {
        //TODO: clean queues in case something has been added while deleting?
        delete scheduler.chartWorkerMapping[this.ctx.chartId];
      }

      //store callback and kick off new work before processing results
      var callback = this.ctx.errorCallback;

      //use thread if work queued
      if(scheduler.queue[this.index].length) {

        //get and do work
        var ctx = scheduler.queue[this.index].splice(0, 1)[0];
        startWork(this, ctx);
      } else {
        this.inUse = false;
      }

      if(callback) {
        callback();
      }
    };

    //create workers and init queue
    for(var i=0; i<threadCount; i++) {

      try {
        var worker = new Worker(Px.vis.workerUrl);
      } catch(e) {

        //failure
        console.warn('failed to find px-vis web worker file at ' + Px.vis.workerUrl);
        console.warn('the charts won\'t be able to determine their extents or find values')
        return;
      }

      //we can load the worker through a data uri if needed
      scheduler.workers.push(worker);

      worker.inUse = true;
      worker.index = i;
      worker.onmessage = processDone;
      worker.onerror = webWorkerError;
      worker.ctx = {};
      worker.ctx.action = 'init';

      //kick a first dummy communication for each worker.
      //The first comm for each worker is slow (needs to parse script)
      //so do it now in order not to suffer the slowdown when actually needing it
      worker.postMessage({'action': 'init', 'd3Url': Px.vis.workerD3Url});
      scheduler.queue.push([]);
    }

    scheduler.registerCustomScript = function(scriptUrl, successCallback, errorCallback) {

      var regCallback,
          errCallback,
          successCounter = 0,
          errCounter = 0,
          ctx;

      //it should be either all registration will fail or all will succeed
      regCallback = function() {
        successCounter++;
        if(successCounter === scheduler.workers.length) {
          //registration on all ww done
          if(successCallback) {
            successCallback();
          }
        } else if(errCounter > 0 && errorCallback) {
          //got some error, some success... just fire error
          errorCallback();
        }
      };

      errCallback = function() {
        errCounter++;
        if(errCounter === scheduler.workers.length) {
          //all reg failed
          if(errorCallback) {
            errorCallback();
          }

        } else if(successCounter > 0 && errorCallback) {
          //got some error, some success... just fire error
          errorCallback();
        }
      };

      ctx = {
            'action': 'registerCustomScript',
            'data': {
              'url': scriptUrl
            },
            'successCallback': regCallback,
            'errorCallback': errCallback
          };

      //run registration on each worker
      for(var i=0; i<scheduler.workers.length; i++) {
        startWork(scheduler.workers[i], ctx);
      }
    }

    Px.vis.scheduler = scheduler;
    window.dispatchEvent(new CustomEvent('px-vis-worker-ready'));
  }
}());
</script>